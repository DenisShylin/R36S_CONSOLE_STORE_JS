# Включаем mod_rewrite
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Если запрашиваемый файл существует, отдаем его напрямую
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # Для языковых URL без конечного слеша добавляем слеш
  RewriteRule ^(en|ru|ar|be|de|es|fr|it|ja|ko|nl|pt|tr|uk)$ $1/ [R=301,L]
  
  # Если URL начинается с языкового кода, отдаем соответствующий index.html
  RewriteRule ^(en|ru|ar|be|de|es|fr|it|ja|ko|nl|pt|tr|uk)/$ $1/index.html [L]
  RewriteRule ^(en|ru|ar|be|de|es|fr|it|ja|ko|nl|pt|tr|uk)/(.*)$ $1/index.html [L]
  
  # Для всех остальных URL отдаем корневой index.html
  RewriteRule ^(.*)$ index.html [L]
</IfModule>

# Добавление правильных MIME-типов
<IfModule mod_mime.c>
  # JavaScript
  AddType application/javascript .js
  AddType application/json .json
  
  # Добавление MIME типа для JavaScript модулей
  AddType application/javascript .mjs
  
  # CSS
  AddType text/css .css
  
  # Шрифты
  AddType font/ttf .ttf
  AddType font/otf .otf
  AddType font/woff .woff
  AddType font/woff2 .woff2
  
  # SVG
  AddType image/svg+xml .svg
  
  # Изображения
  AddType image/jpeg .jpg .jpeg
  AddType image/png .png
  AddType image/gif .gif
  AddType image/webp .webp
  
  # Видео
  AddType video/mp4 .mp4
  AddType video/webm .webm
</IfModule>

# Разрешение доступа к медиа-файлам
<FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|mp4|webm)$">
  Order allow,deny
  Allow from all
  Satisfy Any
</FilesMatch>

# Кэширование ресурсов
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Кэширование изображений на 1 месяц
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType image/svg+xml "access plus 1 month"
  
  # Кэширование видео на 1 неделю
  ExpiresByType video/mp4 "access plus 1 week"
  ExpiresByType video/webm "access plus 1 week"
  
  # Кэширование CSS и JavaScript на 1 неделю
  ExpiresByType text/css "access plus 1 week"
  ExpiresByType application/javascript "access plus 1 week"
  ExpiresByType application/json "access plus 1 week"
</IfModule>

# Включение GZIP-сжатия
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE font/ttf
  AddOutputFilterByType DEFLATE font/otf
  AddOutputFilterByType DEFLATE font/woff
  AddOutputFilterByType DEFLATE font/woff2
</IfModule>

# Запрет доступа к системным файлам
<FilesMatch "^\.|package(-lock)?\.json$|^composer\.json$|^\.htaccess$">
  Order allow,deny
  Deny from all
</FilesMatch>

# Настройка заголовков доступа
<IfModule mod_headers.c>
  # Разрешаем кросс-доменные запросы
  Header set Access-Control-Allow-Origin "*"
  
  # Устанавливаем правильные заголовки для ресурсов
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|mp4|webm|js|css)$">
    Header set Cache-Control "public, max-age=31536000"
    Header unset ETag
  </FilesMatch>
</IfModule>

# Принудительное использование HTTPS (раскомментируйте если нужно)
# <IfModule mod_rewrite.c>
#   RewriteEngine On
#   RewriteCond %{HTTPS} off
#   RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
# </IfModule>