{"version":3,"file":"index.js","sources":["../src/js/hero.js","../src/main.js"],"sourcesContent":["/**\n * @fileoverview Hero section initialization module\n * @description Contains functions for hero section setup, image management,\n * responsiveness, and event handlers for buttons.\n */\n\n/**\n * Initializes the Hero section on the page.\n * Sets up images, handles load events, configures responsiveness and animations.\n * @returns {Function} Cleanup function to remove event listeners and observers\n */\nexport function initHero() {\n  console.log('Hero section initialized');\n\n  // DOM elements\n  const heroSection = document.querySelector('.hero');\n  const heroImage = document.querySelector('.hero__console-img');\n  const heroContent = document.querySelector('.hero__content');\n  const desktopDescription = document.querySelector(\n    '.hero__description--desktop'\n  );\n  const mobileDescription = document.querySelector(\n    '.hero__description--mobile'\n  );\n  const heroPricing = document.querySelector('.hero__pricing');\n  const buyButton = document.getElementById('buy-button');\n  const moreDetailsButton = document.getElementById('more-details-button');\n\n  // Хранение ссылок на обсерверы для корректного удаления\n  let contentObserver = null;\n\n  /**\n   * Sets up hero section images.\n   * Establishes event handlers for the main image.\n   * @private\n   */\n  function setupHeroImage() {\n    if (!heroImage) {\n      console.error('Hero image element not found');\n      return;\n    }\n\n    console.log('Setting up hero image');\n\n    // Event handlers\n    heroImage.onerror = () => {\n      console.error('Failed to load hero image:', heroImage.src);\n\n      try {\n        // Получаем первый элемент из srcset как запасной вариант\n        const srcsetParts = heroImage.getAttribute('srcset');\n        if (srcsetParts) {\n          const parts = srcsetParts.split(',');\n          if (parts && parts.length > 0) {\n            const fallbackSrc = parts[0].split(' ')[0]; // Берем первый источник из srcset\n            console.log('Using fallback image:', fallbackSrc);\n            heroImage.src = fallbackSrc;\n          }\n        }\n      } catch (error) {\n        console.error('Error setting fallback image:', error);\n      }\n\n      if (heroSection) {\n        heroSection.classList.add('hero--loaded'); // Still show the section\n      }\n    };\n\n    heroImage.onload = () => {\n      console.log('Hero image loaded successfully');\n      if (heroSection) {\n        heroSection.classList.add('hero--loaded');\n      }\n    };\n\n    // Add decoding attribute for better performance\n    heroImage.decoding = 'async';\n\n    // If the image is already loaded (from cache)\n    if (heroImage.complete) {\n      console.log('Hero image already loaded (from cache)');\n      if (heroSection) {\n        heroSection.classList.add('hero--loaded');\n      }\n    }\n  }\n\n  /**\n   * Adapts content for different screen sizes.\n   * Toggles between mobile and desktop versions of the description.\n   * @private\n   */\n  function adjustForViewport() {\n    const isDesktop = window.innerWidth > 992;\n\n    if (desktopDescription && mobileDescription && heroPricing) {\n      if (isDesktop) {\n        desktopDescription.style.display = 'block';\n        mobileDescription.style.display = 'none';\n      } else {\n        desktopDescription.style.display = 'none';\n        mobileDescription.style.display = 'block';\n      }\n    }\n  }\n\n  /**\n   * Sets up content appearance animation on scroll.\n   * Uses IntersectionObserver to determine element visibility.\n   * @private\n   */\n  function setupContentAnimation() {\n    if (!heroContent) return;\n\n    // Удаляем предыдущий observer если он существует\n    if (contentObserver) {\n      contentObserver.disconnect();\n      contentObserver = null;\n    }\n\n    try {\n      contentObserver = new IntersectionObserver(\n        entries => {\n          try {\n            entries.forEach(entry => {\n              // Проверяем, что элемент всё еще присутствует в DOM\n              if (\n                entry.isIntersecting &&\n                entry.target &&\n                entry.target.isConnected\n              ) {\n                entry.target.classList.add('animate-in');\n                // Отключаем наблюдение после анимации\n                if (contentObserver) {\n                  contentObserver.unobserve(entry.target);\n                }\n              }\n            });\n          } catch (err) {\n            console.warn('Error in IntersectionObserver callback:', err);\n          }\n        },\n        { threshold: 0.1 }\n      );\n\n      // Проверяем, существует ли элемент перед наблюдением\n      if (heroContent && heroContent.isConnected) {\n        contentObserver.observe(heroContent);\n      }\n    } catch (error) {\n      console.warn('Error setting up IntersectionObserver:', error);\n    }\n  }\n\n  /**\n   * Sets up event handlers for section buttons.\n   * @private\n   */\n  function setupButtonHandlers() {\n    // Handler for buy button\n    if (buyButton) {\n      // Удаляем предыдущие обработчики, чтобы избежать дублирования\n      buyButton.removeEventListener('click', handleBuyButtonClick);\n      buyButton.addEventListener('click', handleBuyButtonClick);\n    }\n\n    // Handler for \"More details\" button\n    if (moreDetailsButton) {\n      // Удаляем предыдущие обработчики, чтобы избежать дублирования\n      moreDetailsButton.removeEventListener('click', handleMoreDetailsClick);\n      moreDetailsButton.addEventListener('click', handleMoreDetailsClick);\n    }\n  }\n\n  /**\n   * Обработчик клика по кнопке Buy\n   * @private\n   */\n  function handleBuyButtonClick() {\n    try {\n      // Open product link in new tab\n      window.open(\n        'https://www.aliexpress.com/item/1005007171465465.html',\n        '_blank',\n        'noopener,noreferrer'\n      );\n    } catch (error) {\n      console.error('Error opening product link:', error);\n    }\n  }\n\n  /**\n   * Handles click on \"More details\" button.\n   * Performs smooth scrolling to features section.\n   * @param {Event} e - Click event\n   * @private\n   */\n  function handleMoreDetailsClick(e) {\n    e.preventDefault();\n    const featuresSection = document.getElementById('features');\n    const header = document.querySelector('.header');\n\n    if (featuresSection && header) {\n      try {\n        // Account for fixed header height when scrolling\n        const headerHeight = header.offsetHeight;\n        const elementPosition = featuresSection.getBoundingClientRect().top;\n        const currentScrollY = window.scrollY || window.pageYOffset;\n        const offsetPosition = elementPosition + currentScrollY - headerHeight;\n\n        // Smooth scroll to features section\n        window.scrollTo({\n          top: offsetPosition,\n          behavior: 'smooth',\n        });\n\n        // Update URL without page reload\n        window.history.replaceState(\n          null,\n          '',\n          `${window.location.pathname}#features`\n        );\n      } catch (error) {\n        console.error('Error scrolling to features:', error);\n\n        // Запасной вариант - обычный переход по якорю\n        window.location.hash = 'features';\n      }\n    }\n  }\n\n  /**\n   * Функция очистки слушателей и наблюдателей\n   * @private\n   */\n  function cleanup() {\n    try {\n      // Отключаем IntersectionObserver\n      if (contentObserver) {\n        contentObserver.disconnect();\n        contentObserver = null;\n      }\n\n      // Удаляем слушатель событий resize\n      window.removeEventListener('resize', adjustForViewport);\n\n      // Удаляем обработчики кнопок\n      if (buyButton) {\n        buyButton.removeEventListener('click', handleBuyButtonClick);\n      }\n\n      if (moreDetailsButton) {\n        moreDetailsButton.removeEventListener('click', handleMoreDetailsClick);\n      }\n\n      // Удаляем обработчик unload\n      window.removeEventListener('unload', cleanup);\n      window.removeEventListener('beforeunload', cleanup);\n    } catch (error) {\n      console.warn('Error during cleanup:', error);\n    }\n  }\n\n  // Component initialization\n  setupHeroImage();\n  adjustForViewport();\n  setupContentAnimation();\n  setupButtonHandlers();\n\n  // Listen for window resize event\n  window.removeEventListener('resize', adjustForViewport); // Удаляем предыдущие\n  window.addEventListener('resize', adjustForViewport);\n\n  // Используем более надежный способ для очистки - beforeunload вместо unload\n  if (typeof window !== 'undefined') {\n    window.removeEventListener('beforeunload', cleanup); // Удаляем предыдущий\n    window.addEventListener('beforeunload', cleanup);\n  }\n\n  // Возвращаем функцию очистки\n  return cleanup;\n}\n","// main.js - Точка входа в приложение\n// Импорт всех стилей\nimport './css/styles.css';\nimport './css/hero.css';\n// Другие стили при необходимости\n\n// Импорт компонентов\nimport { initHero } from './js/hero.js';\n// Другие компоненты при необходимости\n\nconsole.log('Main.js инициализирован');\n\n// Хранение функций очистки для компонентов\nlet cleanupFunctions = [];\n\n// Вспомогательная функция для определения поддержки браузером\nfunction checkBrowserCompatibility() {\n  // Проверка поддержки IntersectionObserver (для анимаций при скролле)\n  const hasIntersectionObserver = 'IntersectionObserver' in window;\n  // Проверка поддержки Flexbox\n  const hasFlexbox = (function () {\n    const el = document.createElement('div');\n    el.style.display = 'flex';\n    return el.style.display === 'flex';\n  })();\n  // Проверка поддержки CSS Grid\n  const hasGrid = (function () {\n    const el = document.createElement('div');\n    el.style.display = 'grid';\n    return el.style.display === 'grid';\n  })();\n  // Логирование результатов проверок\n  console.log('Поддержка браузера:');\n  console.log('- IntersectionObserver:', hasIntersectionObserver);\n  console.log('- Flexbox:', hasFlexbox);\n  console.log('- CSS Grid:', hasGrid);\n  // Добавление классов к body для условного стилизования\n  if (!hasIntersectionObserver)\n    document.body.classList.add('no-intersection-observer');\n  if (!hasFlexbox) document.body.classList.add('no-flexbox');\n  if (!hasGrid) document.body.classList.add('no-grid');\n  return {\n    hasIntersectionObserver,\n    hasFlexbox,\n    hasGrid,\n  };\n}\n\n// Глобальная функция очистки\nfunction globalCleanup() {\n  try {\n    // Вызываем все функции очистки\n    cleanupFunctions.forEach(cleanupFn => {\n      if (typeof cleanupFn === 'function') {\n        cleanupFn();\n      }\n    });\n    // Очищаем массив\n    cleanupFunctions = [];\n  } catch (error) {\n    console.warn('Error during global cleanup:', error);\n  }\n}\n\n// Инициализация страницы после загрузки DOM\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('DOM загружен');\n\n  try {\n    // Проверка совместимости браузера\n    const compatibility = checkBrowserCompatibility();\n\n    // Инициализация компонентов и сохранение функций очистки\n    const heroCleanup = initHero();\n    if (typeof heroCleanup === 'function') {\n      cleanupFunctions.push(heroCleanup);\n    }\n\n    // Добавим информацию о загрузке страницы в консоль для отладки\n    const loadTime = performance.now();\n    console.log(`Страница загружена за ${loadTime.toFixed(2)}ms`);\n\n    // Регистрируем обработчик для очистки при закрытии/перезагрузке\n    window.addEventListener('beforeunload', globalCleanup);\n  } catch (error) {\n    console.error('Ошибка при инициализации страницы:', error);\n  }\n});\n\n// Обработка ошибок на уровне window\nwindow.onerror = function (message, source, lineno, colno, error) {\n  console.error('Глобальная ошибка:', {\n    message,\n    source,\n    lineno,\n    colno,\n    error,\n  });\n  return false; // Пусть браузер также показывает ошибки в консоли\n};\n\n// Обработка непойманных промисов\nwindow.addEventListener('unhandledrejection', function (event) {\n  console.warn(\n    'Непойманное отклонение промиса (unhandled promise rejection):',\n    event.reason\n  );\n});\n\n// Экспорт версии приложения для отладки\nwindow.appVersion = {\n  version: '1.0.0',\n  buildDate: new Date().toISOString(),\n  environment: import.meta.env.MODE,\n  basePath: import.meta.env.DEV ? '/' : '/R36S_CONSOLE_STORE_JS/',\n};\n\n// Регистрация обработчика cleanup при выгрузке модуля (для hot-reload)\nif (import.meta.hot) {\n  import.meta.hot.dispose(() => {\n    globalCleanup();\n  });\n}\n\nconsole.log('Main.js выполнение завершено');\n"],"names":["initHero","heroSection","heroImage","heroContent","desktopDescription","mobileDescription","heroPricing","buyButton","moreDetailsButton","contentObserver","setupHeroImage","srcsetParts","parts","fallbackSrc","error","adjustForViewport","isDesktop","setupContentAnimation","entries","entry","err","setupButtonHandlers","handleBuyButtonClick","handleMoreDetailsClick","e","featuresSection","header","headerHeight","elementPosition","currentScrollY","offsetPosition","cleanup","cleanupFunctions","checkBrowserCompatibility","hasIntersectionObserver","hasFlexbox","el","hasGrid","globalCleanup","cleanupFn","compatibility","heroCleanup","loadTime","message","source","lineno","colno","event"],"mappings":"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"}